<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generalised Additive Models in greta using mgcv • greta.gam</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Generalised Additive Models in greta using mgcv">
<meta name="description" content="A module for greta (Golding (2019) &lt;doi:10.21105/joss.01601&gt;) that lets you use the mgcv smoother functions and formula syntax to define smooth terms for use in a greta model. You can then define your own likelihood to complete the model, and fit it by MCMC.">
<meta property="og:description" content="A module for greta (Golding (2019) &lt;doi:10.21105/joss.01601&gt;) that lets you use the mgcv smoother functions and formula syntax to define smooth terms for use in a greta model. You can then define your own likelihood to complete the model, and fit it by MCMC.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">greta.gam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/greta-dev/greta.gam/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="gretagam-generalised-additive-models-in-greta-using-mgcv">greta.gam: generalised additive models in greta using mgcv<a class="anchor" aria-label="anchor" href="#gretagam-generalised-additive-models-in-greta-using-mgcv"></a>
</h1></div>
<!-- badges: start -->

<p>greta.gam lets you use <a href="https://CRAN.R-project.org/package=mgcv" class="external-link">mgcv</a>’s smoother functions and formula syntax to define smooth terms for use in a <a href="https://greta-stats.org/" class="external-link">greta</a> model. You can then define your own likelihood to complete the model, and fit it by MCMC.</p>
<p>The design and architecture of the package was done by <a href="https://github.com/goldingn" class="external-link">Nick Golding</a>, and <a href="https://github.com/dill" class="external-link">David L Miller</a>.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>You can install the development version of <code>greta.gam</code> from the <a href="https://greta-dev.r-universe.dev/greta.gam" class="external-link">R-universe</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"greta.gam"</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://greta-dev.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Or you can install from CRAN with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"greta.gam"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Here’s a simple example adapted from the <code>mgcv</code> <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">?gam</a></code> help file:</p>
<p>In <code>mgcv</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; This is mgcv 1.9-1. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate some data...</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">gamSim</a></span><span class="op">(</span><span class="fl">1</span>, n <span class="op">=</span> <span class="fl">400</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, scale <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Gu &amp; Wahba 4 term additive model</span></span>
<span></span>
<span><span class="co"># fit a model using gam()</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p>Now fitting the same model in <code>greta</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/greta-dev/greta.gam" class="external-link">greta.gam</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: greta</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'greta'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     binomial, cov2cor, poisson</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %*%, apply, backsolve, beta, chol2inv, colMeans, colSums, diag,</span></span>
<span><span class="co">#&gt;     eigen, forwardsolve, gamma, identity, rowMeans, rowSums, sweep,</span></span>
<span><span class="co">#&gt;     tapply</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span> <span class="op">-</span> <span class="fl">02</span> <span class="op">-</span> <span class="fl">09</span><span class="op">)</span></span>
<span><span class="co"># setup the linear predictor for the smooth</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/smooths.html">smooths</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Initialising python and checking dependencies, this may take a moment.</span></span>
<span><span class="co">#&gt; ✔ Initialising python and checking dependencies ... done!               </span></span>
<span></span>
<span><span class="co"># set the distribution of the response</span></span>
<span><span class="fu"><a href="https://greta-stats.org/reference/distribution.html" class="external-link">distribution</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://greta-stats.org/reference/distributions.html" class="external-link">normal</a></span><span class="op">(</span><span class="va">z</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make some prediction data</span></span>
<span><span class="va">pred_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># z_pred stores the predictions</span></span>
<span><span class="va">z_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/evaluate_smooths.html">evaluate_smooths</a></span><span class="op">(</span><span class="va">z</span>, newdata <span class="op">=</span> <span class="va">pred_dat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build model</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://greta-stats.org/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="va">z_pred</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw from the posterior</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu">mcmc</span><span class="op">(</span><span class="va">m</span>, n_samples <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; running 4 chains simultaneously on up to 8 CPU cores</span></span>
<span><span class="co">#&gt;     warmup                                           0/1000 | eta:  ?s              warmup ==                                       50/1000 | eta: 27s              warmup ====                                    100/1000 | eta: 15s              warmup ======                                  150/1000 | eta: 10s              warmup ========                                200/1000 | eta:  8s              warmup ==========                              250/1000 | eta:  7s              warmup ===========                             300/1000 | eta:  6s              warmup =============                           350/1000 | eta:  5s              warmup ===============                         400/1000 | eta:  4s              warmup =================                       450/1000 | eta:  4s              warmup ===================                     500/1000 | eta:  3s              warmup =====================                   550/1000 | eta:  3s              warmup =======================                 600/1000 | eta:  2s              warmup =========================               650/1000 | eta:  2s              warmup ===========================             700/1000 | eta:  2s              warmup ============================            750/1000 | eta:  1s              warmup ==============================          800/1000 | eta:  1s              warmup ================================        850/1000 | eta:  1s              warmup ==================================      900/1000 | eta:  1s              warmup ====================================    950/1000 | eta:  0s              warmup ====================================== 1000/1000 | eta:  0s          </span></span>
<span><span class="co">#&gt;   sampling                                            0/200 | eta:  ?s            sampling ==========                                50/200 | eta:  0s            sampling ===================                      100/200 | eta:  0s            sampling ============================             150/200 | eta:  0s            sampling ======================================   200/200 | eta:  0s</span></span>
<span></span>
<span><span class="co"># plot the mgcv fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b</span>, scheme <span class="op">=</span> <span class="fl">1</span>, shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add in a line for each posterior sample</span></span>
<span><span class="fu"><a href="https://greta-stats.org/reference/overloaded.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">lines</span>, x <span class="op">=</span> <span class="va">pred_dat</span><span class="op">$</span><span class="va">x2</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="co"># plot the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x2</span>, <span class="va">dat</span><span class="op">$</span><span class="va">y</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-greta-fit-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="brief-technical-details">Brief technical details<a class="anchor" aria-label="anchor" href="#brief-technical-details"></a>
</h2>
<p><code>greta.gam</code> uses a few tricks from the <code>jagam</code> (Wood, 2016) routine in <code>mgcv</code> to get things to work. Here are some brief details for those interested in the internal workings.</p>
<div class="section level3">
<h3 id="bayesian-interpretation-of-the-gam">Bayesian interpretation of the GAM<a class="anchor" aria-label="anchor" href="#bayesian-interpretation-of-the-gam"></a>
</h3>
<p>GAMs are models with Bayesian interpretations (even when fitted using “frequentist” methods). One can think of the smoother penalty matrix as a prior precision matrix in a Bayesian random effects model. Design matrices are constructed exactly as in the frequentist case. See <a href="https://arxiv.org/abs/1902.01330" class="external-link">Miller (2021)</a> for more background on this.</p>
</div>
<div class="section level3">
<h3 id="penalty-matrices">Penalty matrices<a class="anchor" aria-label="anchor" href="#penalty-matrices"></a>
</h3>
<p>There is a slight difficulty in the Bayesian interpretation of the GAM in that, in their naïve form the priors are improper as the nullspace of the penalty (in the 1D case, usually the linear term). To get proper priors we can use one of the “tricks” employed in Marra &amp; Wood (2011) – that is to somehow penalise the parts of the penalty that lead to the improper prior. We take the option provided by <code>jagam</code> and create an additional penalty matrix for these terms (from an eigen-decomposition of the penalty matrix; see Marra &amp; Wood, 2011).</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Marra, G and Wood, SN (2011) Practical variable selection for generalized additive models. Computational Statistics and Data Analysis, 55, 2372–2387.</p>
<p>Miller DL (2021). Bayesian views of generalized additive modelling. arXiv.</p>
<p>Wood, SN (2016) Just Another Gibbs Additive Modeler: Interfacing JAGS and mgcv. Journal of Statistical Software 75, no. 7</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/greta-dev/greta.gam/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/greta-dev/greta.gam/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing greta.gam</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Nick Golding <br><small class="roles"> Author, copyright holder </small> <a href="https://orcid.org/0000-0001-8916-5570" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Nicholas Tierney <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1460-8722" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>David L Miller <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/greta-dev/greta.gam/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/greta-dev/greta.gam/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/greta-dev/greta.gam?branch=main" class="external-link"><img src="https://codecov.io/gh/greta-dev/greta.gam/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nick Golding, Nicholas Tierney, David L Miller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
