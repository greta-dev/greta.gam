<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started • greta.gam</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">greta.gam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/greta-dev/greta.gam/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/greta-dev/greta.gam/blob/v0.2.0/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<p>greta.gam lets you use <a href="https://CRAN.R-project.org/package=mgcv" class="external-link">mgcv</a>’s smoother
functions and formula syntax to define smooth terms for use in a <a href="https://greta-stats.org/" class="external-link">greta</a> model. You can then define
your own likelihood to complete the model, and fit it by MCMC.</p>
<p>The design and architecture of the package was done by <a href="https://github.com/goldingn" class="external-link">Nick Golding</a>, and <a href="https://github.com/dill" class="external-link">David L Miller</a>.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Here’s a simple example adapted from the <code>mgcv</code>
<code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">?gam</a></code> help file. In <code>mgcv</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span> <span class="op">-</span> <span class="fl">12</span> <span class="op">-</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate some data...</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">gamSim</a></span><span class="op">(</span><span class="fl">1</span>, n <span class="op">=</span> <span class="fl">400</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, scale <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co"># fit a model using gam()</span></span>
<span><span class="va">mgcv_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">mgcv_fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mgcv_fit</span><span class="op">)</span></span>
<span><span class="co">## show partial residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mgcv_fit</span>, scheme <span class="op">=</span> <span class="fl">1</span>, shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mgcv_fit</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Now fitting the same model in <code>greta</code>. We first start by
setting up the linear predictor for the smooth. That is, the right hand
side of the formula:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/greta-dev/greta.gam" class="external-link">greta.gam</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span> <span class="op">-</span> <span class="fl">02</span> <span class="op">-</span> <span class="fl">09</span><span class="op">)</span></span>
<span><span class="co"># setup the linear predictor for the smooth</span></span>
<span><span class="va">linear_predictor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooths.html">smooths</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">linear_predictor</span></span></code></pre></div>
<p>Now we specify the distribution of the response:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://greta-stats.org/reference/distributions.html" class="external-link">cauchy</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, truncation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://greta-stats.org/reference/distribution.html" class="external-link">distribution</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://greta-stats.org/reference/distributions.html" class="external-link">normal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">linear_predictor</span>, sd <span class="op">=</span> <span class="va">dist_sd</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s make some prediction data</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred_dat</span><span class="op">)</span></span></code></pre></div>
<p>We run <code>evaluate_smooths</code> on the linear predicting with
the new prediction data</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_smooths.html">evaluate_smooths</a></span><span class="op">(</span><span class="va">linear_predictor</span>, newdata <span class="op">=</span> <span class="va">pred_dat</span><span class="op">)</span></span>
<span><span class="va">linear_preds</span></span></code></pre></div>
<p>Now we specify that as a model object and then fit with MCMC as we do
with greta normally:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build model</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://greta-stats.org/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="va">linear_preds</span><span class="op">)</span></span>
<span><span class="va">m</span></span>
<span><span class="co"># draw from the posterior</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu">mcmc</span><span class="op">(</span><span class="va">m</span>, n_samples <span class="op">=</span> <span class="fl">200</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span>
<span><span class="co"># 4 chains</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 200 draws, 100 predictors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># look at the top corner</span></span>
<span><span class="va">draws</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<p>Now let’s compare the <code>mgcv</code> model fit to the
<code>greta.gam</code> fit:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mgcv_fit</span>, scheme <span class="op">=</span> <span class="fl">1</span>, shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mgcv_fit</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add in a line for each posterior sample</span></span>
<span><span class="fu"><a href="https://greta-stats.org/reference/overloaded.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">lines</span>, x <span class="op">=</span> <span class="va">pred_dat</span><span class="op">$</span><span class="va">x2</span>, </span>
<span>      col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="st">"firebrick"</span>, alpha.f <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x2</span>, <span class="va">dat</span><span class="op">$</span><span class="va">y</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p>The <code>mgcv</code> predictions are in the grey ribbon, and the
<code>greta.gam</code> ones are in red - we can see that the greta
predictions are within the range of the mgcv, which is good news!</p>
</div>
<div class="section level3">
<h3 id="brief-technical-details">Brief technical details<a class="anchor" aria-label="anchor" href="#brief-technical-details"></a>
</h3>
<p><code>greta.gam</code> uses a few tricks from the <code>jagam</code>
(Wood, 2016) routine in <code>mgcv</code> to get things to work. Here
are some brief details for those interested in the internal
workings.</p>
<div class="section level4">
<h4 id="bayesian-interpretation-of-the-gam">Bayesian interpretation of the GAM<a class="anchor" aria-label="anchor" href="#bayesian-interpretation-of-the-gam"></a>
</h4>
<p>GAMs are models with Bayesian interpretations (even when fitted using
“frequentist” methods). One can think of the smoother penalty matrix as
a prior precision matrix in a Bayesian random effects model. Design
matrices are constructed exactly as in the frequentist case. See <a href="https://arxiv.org/abs/1902.01330" class="external-link">Miller (2021)</a> for more
background on this.</p>
</div>
<div class="section level4">
<h4 id="penalty-matrices">Penalty matrices<a class="anchor" aria-label="anchor" href="#penalty-matrices"></a>
</h4>
<p>There is a slight difficulty in the Bayesian interpretation of the
GAM in that, in their naïve form the priors are improper as the
nullspace of the penalty (in the 1D case, usually the linear term). To
get proper priors we can use one of the “tricks” employed in Marra &amp;
Wood (2011) – that is to somehow penalise the parts of the penalty that
lead to the improper prior. We take the option provided by
<code>jagam</code> and create an additional penalty matrix for these
terms (from an eigen-decomposition of the penalty matrix; see Marra
&amp; Wood, 2011).</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Marra, G and Wood, SN (2011) Practical variable selection for
generalized additive models. Computational Statistics and Data Analysis,
55, 2372–2387.</p>
<p>Miller DL (2021). Bayesian views of generalized additive modelling.
arXiv.</p>
<p>Wood, SN (2016) Just Another Gibbs Additive Modeler: Interfacing JAGS
and mgcv. Journal of Statistical Software 75, no. 7</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nick Golding, Nicholas Tierney, David L Miller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
